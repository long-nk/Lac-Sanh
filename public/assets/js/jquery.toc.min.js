/*! Table of Contents jQuery Plugin - jquery.toc */
!function(a) {
  "use strict";
  
  // Hàm chuyển tiếng Việt có dấu sang không dấu
  var removeVietnameseTones = function(str) {
    return str.normalize('NFD')
      .replace(/[\u0300-\u036f]/g, '') // Loại bỏ dấu
      .replace(/đ/g, 'd').replace(/Đ/g, 'D') // Thay đ thành d
      .replace(/[^a-zA-Z0-9\s]/g, '') // Loại bỏ các ký tự đặc biệt
      .replace(/\s+/g, '_') // Chuyển khoảng trắng thành dấu gạch dưới
      .toLowerCase(); // Chuyển thành chữ thường
  };

  var b = function(b) {
    return this.each(function() {
      var c, d, e = a(this), f = e.data(), g = [e], h = this.tagName, i = 0;
      
      c = a.extend({content: "body", headings: "h1,h2,h3"}, {content: f.toc || void 0, headings: f.tocHeadings || void 0}, b);
      d = c.headings.split(",");
      
      a(c.content).find(c.headings).attr("id", function(b, c) {
        // Sử dụng removeVietnameseTones để chuyển tiêu đề thành không dấu
        var d = function(a) {
          0 === a.length && (a = "?");
          for (var b = removeVietnameseTones(a.replace(/\s+/g, "_")), c = "", d = 1; null !== document.getElementById(b + c);) c = "_" + d++;
          return b + c;
        };
        return c || d(a(this).text());
      }).each(function() {
        var b = a(this),
            c = a.map(d, function(a, c) { return b.is(a) ? c : void 0 })[0];
        
        if (c > i) {
          var e = g[0].children("li:last")[0];
          e && g.unshift(a("<" + h + "/>").appendTo(e));
        } else g.splice(0, Math.min(i - c, Math.max(g.length - 1, 0)));
        
        a("<li/>").appendTo(g[0])
          .append(a("<span/>").text(b.text()).attr("data-href", "#" + b.attr("id")));
        
        i = c;
      });
    });
  };
  
  var c = a.fn.toc;
  a.fn.toc = b;
  a.fn.toc.noConflict = function() {
    return a.fn.toc = c, this;
  };
  
  a(function() { b.call(a("[data-toc]")) });
}(window.jQuery);